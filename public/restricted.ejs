<!DOCTYPE html>
<html>
    <% include ./ejs/head %>
<body>
  <h1>Crear Propiedad</h1>
  <form id="propiedadForm">
    <label for="nombre">Nombre:</label>
    <input type="text" id="nombre" required><br><br>

    <label for="descripcion">Descripción:</label>
    <textarea id="descripcion" required></textarea><br><br>

    <label for="precio">Precio:</label>
    <input type="number" id="precio" required><br><br>

    <label for="esDestacado">Es destacado:</label>
    <input type="checkbox" id="esDestacado"><br><br>

    <label for="tipo">Tipo:</label>
    <select id="tipo" required>
      <option value="">Seleccione un tipo</option>
      <option value="Casas">Casas</option>
      <option value="Departamentos">Departamentos</option>
      <option value="Fideicomisos">Fideicomisos</option>
      <option value="Proyectos">Proyectos</option>
      <option value="Locales">Locales</option>
    </select><br><br>

    <label for="condicion">Condición:</label>
    <select id="condicion" required>
      <option value="">Seleccione una condición</option>
      <option value="Venta">Venta</option>
      <option value="Alquiler">Alquiler</option>
    </select><br><br>

    <button type="submit">Crear</button>
  </form>


      <h1>Subir Fotos</h1>
  
      <form id="fotosForm" enctype="multipart/form-data">
        <label for="propiedadId">Propiedad:</label>
        <select id="propiedadId" name="propiedadId">
          <!-- Opciones de propiedades -->
        </select>
        <br>
  
        <label for="fotos">Fotos:</label>
        <input type="file" id="fotos" name="fotos" accept="image/*" multiple>
        <br>
  
        <input type="submit" value="Enviar">
      </form>


      
      <h1>Lista de Propiedades</h1>
      <button onclick="getPropiedades()">listar</button>
    
      <div id="propiedades-container"></div>
  
      <script>
        // Obtén las propiedades disponibles y rellena el dropdown
        fetch("api/propiedades")
          .then((response) => response.json())
          .then((data) => {
            const propiedadDropdown = document.getElementById("propiedadId");
            data.forEach((propiedad) => {
              const option = document.createElement("option");
              option.value = propiedad.id;
              option.textContent = propiedad.nombre;
              propiedadDropdown.appendChild(option);
            });
          })
          .catch((error) => {
            console.error("Error al obtener las propiedades:", error);
          });
  
        // Agrega un listener al evento submit del formulario
        document.getElementById("fotosForm").addEventListener("submit", (event) => {
          event.preventDefault(); // Evita que el formulario se envíe de forma predeterminada
  
          // Obtiene el ID de la propiedad seleccionada
          const propiedadId = document.getElementById("propiedadId").value;
  
          // Obtiene los archivos de imagen seleccionados
          const fotosInput = document.getElementById("fotos");
          const fotos = fotosInput.files;
         
  
          // Crea un objeto FormData para enviar los datos
          const formData = new FormData();
          formData.append("propiedadId", propiedadId);
          console.log(formData)
          for (let i = 0; i < fotos.length; i++) {
            formData.append("fotos", fotos[i]);
            console.log(formData)
          }
           console.log(formData)
  
          // Realiza una solicitud HTTP al servidor para subir las fotos
          fetch("/subir-fotos", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              alert("Fotos enviadas exitosamente", data);
              // Puedes realizar alguna acción adicional después de enviar las fotos
            })
            .catch((error) => {
              console.error("Error al enviar las fotos:", error);
              alert("Error al enviar las fotos");
            });
        });
      </script>
    
  



  <script src="./javascripts/restricted.js"></script>
</body>
</html>
